# based on: https://github.com/PHPirates/travis-ci-latex-pdf
language: generic
before_install:
- sudo apt-get install -y imagemagick ghostscript
# converting PDFs is disabled by default (for security)
- sudo sed -i '/PDF/s/none/write|read/g' /etc/ImageMagick-6/policy.xml
install:
- export PATH="$HOME/miniconda/bin:$PATH"
- if ! command -v conda > /dev/null; then wget https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh
  -O miniconda.sh; bash miniconda.sh -b -p $HOME/miniconda -u; conda config --add
  channels conda-forge; conda config --set always_yes yes; conda install tectonic==0.1.11;
  fi
cache:
  directories:
  - "$HOME/miniconda"
  - "$HOME/.cache/Tectonic"
script:
- tectonic ./cv.tex --print
- tectonic ./cover.tex --print
after_success:
- convert -density 600 cv.pdf -quality 90 cv.png
- convert -density 600 cover.pdf -quality 90 cover.png
- git remote add origin-token https://${GITHUBTOKEN}@github.com/hesseltuinhof/simpleCV
- git push origin-token :assets
- git branch -d assets
- git checkout --orphan assets
- git rm -rf fonts/ && git rm -f *.tex *.sty *.cls
- git add cv.png cv.pdf cover.png cover.pdf
- git config user.email "travis@travis-ci.org" && git config user.name "Travis CI"
- git commit -m "Travis auto upload $TRAVIS_BUILD_NUMBER" && git push --quiet origin-token assets
